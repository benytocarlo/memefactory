<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Editor de Imagenes</title>
<link href="css/style.css" rel='stylesheet' type='text/css'/>
<link href="css/jpicker.css" rel='stylesheet' type='text/css'/>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
<link href='http://fonts.googleapis.com/css?family=Chicle|Flavors|Ewert|Creepster|Titan+One' rel='stylesheet' type='text/css'>

<!-- 

Nombres de Tipografias:

font-family: 'Chicle', cursive;
font-family: 'Flavors', cursive;
font-family: 'Ewert', cursive;
font-family: 'Creepster', cursive;
font-family: 'Titan One', cursive;

-->



<style>
.minibox {
width:auto;
height:auto;
padding:4px;
padding-bottom:8px;
margin-left:4px;
margin-bottom:4px;
cursor:move;
}

.minibox .form img { width:100%; height:100%;}


.texto { padding:2px;}
.selected {border:2px dotted red !important; margin:0px !important}

.fila { float:left; width:100%; margin-bottom:10px;}

.minibox { position:absolute; top:25px; left:25px; margin:2px}
.minibox .form {width:100%; height:100%; }

#sandbox_tools { width:500px; margin:25px;}

#sandbox_box { position:relative; float:left;width:810px; height:600px; top:25%; left:15px; background-color:#CFF; clear:left; overflow:hidden}
#sandbox_post { width:250px; float:left;}

.rotate { background-color:green;}



p { margin:0px; float:left}

/* Display None */

#tipo_size, #cerrar_texto, #font-colour-box { display:none;}

.noborders { border:none !important;}

#slider {}
</style>

</head>
<body>
    <div>
    	<div class="fila uploadimage" id="upload_1" rel="1">
    		<label>Añadir Imagen 1</label>
        <input type="file" name="fileToUpload" id="upload1" />
    	</div>
    	<div class="fila uploadimage" id="upload_2" rel="2" style="display:none;">
    		<label>Añadir Imagen 2</label>
        <input type="file" name="fileToUpload" id="upload2" />
    	</div>
    	<div class="fila uploadimage" id="upload_3" rel="3" style="display:none;">
    		<label>Añadir Imagen 3</label>
        <input type="file" name="fileToUpload" id="upload3" />
    	</div>
    	<div class="fila uploadimage" id="upload_4" rel="4" style="display:none;"> 
    		<label>Añadir Imagen 4</label>
        <input type="file" name="fileToUpload" id="upload4" />
    	</div>
        <div id="sandbox_tools">
        	<div class="fila">
            	<button id="add_img">Añadir Imagen</button>
            </div>
            <div class="fila">
            	<label>Añadir Tipo</label>
		        <input type="text" id="texto_input" />
                <button id="addtext">Añadir Texto</button>
            </div>
			<div class="fila">
            	<label>Rotar Imagen</label>
		        <div id="slider"></div>
            </div>
            
            <div class="fila">
            	<label>Posicion</label>
                <button id="arriba">Arriba</button>
                <button id="abajo">Abajo</button>
            </div>
            
            <div class="fila text_buttons">
            	<button id="editar_texto">Editar Texto Seleccionado</button>
                <button id="cerrar_texto">Terminar Edicion de Texto</button>
                <select id="tipos" style="display:none;">
                	<option value="'Arial'">Arial</option>
                    <option value="'Chicle'">Chicle</option>
                    <option value="'Flavors'">Flavors</option>
                    <option value="'Ewert'">Ewert</option>
                    <option value="'Creepster'">Creepster</option>
                    <option value="'Titan One'">Titan One</option>
                </select>
                <select id="tipo_size">
                	<option value="12">12</option>
                    <option value="14">14</option>
                    <option value="16">16</option>
                    <option value="18">18</option>
                    <option value="21">21</option>
                    <option value="24">24</option>
                    <option value="30">30</option>
                    <option value="36">36</option>
                    <option value="42">42</option>
                    <option value="72">72</option>                    
                </select>
                <span id="font-colour-box">
                <select id="colourpicker" name="colour">
                    <option value="ffffff">#ffffff</option>
                    <option value="ffccc9">#ffccc9</option>
                    <option value="ffce93">#ffce93</option>
                    <option value="fffc9e">#fffc9e</option>
                    <option value="ffffc7">#ffffc7</option>
                    <option value="9aff99">#9aff99</option>
                    <option value="96fffb">#96fffb</option>
                    <option value="cdffff">#cdffff</option>
                    <option value="cbcefb">#cbcefb</option>
                    <option value="cfcfcf">#cfcfcf</option>
                    <option value="fd6864">#fd6864</option>
                    <option value="fe996b">#fe996b</option>
                    <option value="fffe65">#fffe65</option>
                    <option value="fcff2f">#fcff2f</option>
                    <option value="67fd9a">#67fd9a</option>
                    <option value="38fff8">#38fff8</option>
                    <option value="68fdff">#68fdff</option>
                    <option value="9698ed">#9698ed</option>
                    <option value="c0c0c0">#c0c0c0</option>
                    <option value="fe0000">#fe0000</option>
                    <option value="f8a102">#f8a102</option>
                    <option value="ffcc67">#ffcc67</option>
                    <option value="f8ff00">#f8ff00</option>
                    <option value="34ff34">#34ff34</option>
                    <option value="68cbd0">#68cbd0</option>
                    <option value="34cdf9">#34cdf9</option>
                    <option value="6665cd">#6665cd</option>
                    <option value="9b9b9b">#9b9b9b</option>
                    <option value="cb0000">#cb0000</option>
                    <option value="f56b00">#f56b00</option>
                    <option value="ffcb2f">#ffcb2f</option>
                    <option value="ffc702">#ffc702</option>
                    <option value="32cb00">#32cb00</option>
                    <option value="00d2cb">#00d2cb</option>
                    <option value="3166ff">#3166ff</option>
                    <option value="6434fc">#6434fc</option>
                    <option value="656565">#656565</option>
                    <option value="9a0000">#9a0000</option>
                    <option value="ce6301">#ce6301</option>
                    <option value="cd9934">#cd9934</option>
                    <option value="999903">#999903</option>
                    <option value="009901">#009901</option>
                    <option value="329a9d">#329a9d</option>
                    <option value="3531ff">#3531ff</option>
                    <option value="6200c9">#6200c9</option>
                    <option value="343434">#343434</option>
                    <option value="680100">#680100</option>
                    <option value="963400">#963400</option>
                    <option value="986536" selected="selected">#986536</option>
                    <option value="646809">#646809</option>
                    <option value="036400">#036400</option>
                    <option value="34696d">#34696d</option>
                    <option value="00009b">#00009b</option>
                    <option value="303498">#303498</option>
                    <option value="000000">#000000</option>
                    <option value="330001">#330001</option>
                    <option value="643403">#643403</option>
                    <option value="663234">#663234</option>
                    <option value="343300">#343300</option>
                    <option value="013300">#013300</option>
                    <option value="003532">#003532</option>
                    <option value="010066">#010066</option>
                    <option value="340096">#340096</option>
                </select>
                </span>
                
                <ul>
                </ul>
                
            </div>
            <div class="fila">
            	<button id="erase_element">Eleminar Elemento Seleccionado</button>
            </div>
            <div class="fila">
              <button id="print_html">Imprimir HTML</button>
              <form action="screenshot.php" method="post" name="form" id="form">
                <input value="" name="html_shoot" id="html_shoot">
              </form>
            </div>
        </div>
        
        
        <div id="sandbox_box"></div>
        <div id="sandbox_post"></div>
        
    </div>
</body>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/1.10.2/TweenMax.min.js"></script>
  <script src="js/jq_rotate_min.js"></script>
  <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
  <script src="js/jpicker.js"></script>
<script>
//Color Picker

$('#colourpicker').colourPicker({
 	ico:    'img/color_picker.png', 
    title:    false
});

  // Funcion subir o bajar
  
  $(function (){
	  
  
	  $("#arriba").click(function(){
	  
	  var z_position = parseInt($('.selected').css("z-index")); 
		  
		  $(".selected").css("z-index", z_position + 1);
	  });
	  
	  $("#abajo").click(function(){
	  var z_position = $('.selected').css("z-index"); 
		  $(".selected").css("z-index", z_position - 1);
	  });
  });

  $(function() {

  // Funcion de Añadir Texto	
	$('#addtext').click(function(){
		$('#sandbox_box').append( "<div class='minibox scale' style='z-index:1;'><p class='texto'>" + $('#texto_input').val() + "</p></div>" );
		$('.minibox').click(function(){$('.minibox').removeClass('selected');$(this).addClass('selected');});
		
		//Editar Texto
		$('#editar_texto').click(function(){
				var text_edit = $('.selected').children('.texto').text();

				if ( $(".texto").parent().hasClass("selected") )
				  {
					var elColor = $('.selected').children('.texto').css("color");
					var elFamily = $('.selected').children('.texto').css("font-family");
					var elSize = $('.selected').children('.texto').css("font-size");

					$('.selected').children('.texto').remove();
					$('.selected').append("<textarea class='edit_block' >"+ text_edit +"</textarea>");
					$('#editar_texto').hide();
					$('#tipos').show();
					$('#cerrar_texto, #tipo_size, #font-colour-box').show();
					$('.selected').children('.edit_block').css("font-family", elFamily)
					$('.selected').children('.edit_block').css("font-size", elSize)
					$('.selected').children('.edit_block').css("color", elColor)
					$("#tipos").change(function() {
						//alert($(this).val());
						$('.selected').children('.edit_block').css("font-family", $(this).val());
					
					});
					$("#tipo_size").change(function() {
						//alert($(this).val());
						$('.selected').children('.edit_block').css("font-size", $(this).val() + "px");
					
					});
				  }
		});
		
		//Cerrar Texto
		$('#cerrar_texto').click(function(){
				var edit_block = $('.edit_block').val();
				var font_family = $('.edit_block').css("font-family");
				var font_size = $('.edit_block').css("font-size");
				var font_color = $('.edit_block').css("color");

				if ( $(".edit_block").parent().hasClass("selected") )
				  {
					$('.selected').children('.edit_block').remove();
					$('.selected').append("<p class='texto'>" + edit_block + "</p>");
					$('.selected').children('.texto').css("font-family", font_family);
					$('.selected').children('.texto').css("font-size", font_size);
					$('.selected').children('.texto').css("color", font_color);
					$('#editar_texto').show();
					$('#tipos option:eq(0)').prop('selected', true);
					$('#tipo_size option:eq(0)').prop('selected', true);
					$('#cerrar_texto, #tipo_size, #font-colour-box').hide();
					$('#tipos').hide();
				  }
		});
		
		
		$(".minibox" ).draggable({ containment: "#sandbox_box", scroll: false });
		$(".minibox").resizable({containment: "#sandbox_box"});
	});
	
	//Eliminar
	$('#erase_element').click(function(){$('.selected').remove();});

	//Print HTML
	$('#print_html').click(function(){$("#sandbox_post").append()});
	
	// Slider JqueryUI
    $( "#slider" ).slider({
      range: "max",
      min: -180,
      max: 180,
	  value: 0,
      slide: function( event, ui ) {
		 var mov = ui.value; 
		  
        $( "#amount" ).val( ui.value );
		$(".rotate").rotate({animateTo:mov})		
      }
    });
	
  });
</script>
<script>
// Funcion PRINT
$('#print_html').click(function(){
  var html = $("#sandbox_box").html();
  $("#html_shoot").val(html);
  var data = {
    img_div: $("#html_shoot").val()
  };
  var ajaxurl = "consultas_sql.php";
  $.post(ajaxurl, data, function(e) {
    var id_insert=e;
    location.href = "screenshot2.php?id_insert="+id_insert;
  });
  //$("#form").submit();
});
</script>
<script type="text/javascript" src="js/ajaxfileupload.js"></script>
<script>
	// Funcion boton añadir imagen 
	
	
    // Funcion para agregar imagenes al Meme
    $('.uploadimage input[type=file]').bind('change', function() {
      var id_input = $(this).attr("id");
  		ajaxFileUpload(id_input);
  	});

    function ajaxFileUpload(id_input)
    {
      var idinput = id_input;
      $("#loading")
      .ajaxStart(function(){
        $(this).show();
      })
      .ajaxComplete(function(){
        $(this).hide();
      });

      $.ajaxFileUpload
      (
        {
          url:'doajaxfileupload.php',
          secureuri:false,
          fileElementId:idinput,
          dataType: 'json',
          data:{name:'logan', id:'id'},
          success: function (data, status)
          {
            if(typeof(data.error) != 'undefined')
            {
              if(data.error != '')
              {
                alert(data.error);
              }else
              {
                var d = new Date();
                var archivo = data.msg;
                var alto = data.alto;
                var ancho = data.ancho;
                var id = "subido-" + data.nombre + "-" + d.getTime();
			          $("div").removeClass("new_img");
                if (alto >= ancho) {
                  if(alto >300){
                    ancho=(300*data.ancho)/data.alto;
                    alto = 300;
                  }
                }else{
                  if(ancho>400){
                    alto=(400*data.alto)/data.ancho;
                    ancho = 400;
                  }
                }

                $("#sandbox_box").append("<div class='minibox new_img' style='width:"+ancho+"px;height:"+alto+"px; z-index:1'><div class='form'><img src='uploads/" + archivo + "'></div></div></div>");

                $("#"+idinput).hide();
                var id_superior = $("#"+idinput).parent().attr('id');
                $("#"+id_superior).hide();
                var sgt_id = $("#"+id_superior).attr("rel");
                if (sgt_id < 4){
                  sgt_id= parseInt(sgt_id)+1;
                  $("#upload_"+sgt_id).fadeIn();
                }
				// Tamaño Default de la imagen
				/*var img_width = $(".new_img img").width();
				var img_height = $(".new_img img").height();
				
				$('.new_img').css("width", "200px")
				$('.new_img').css("height", "auto")*/

				
				$('.new_img img').css({"width":"100%","height":"100%"});
				$('.form').click(function(){$('.form').removeClass('rotate');$('.minibox').removeClass('selected');$(this).addClass('rotate');$(this).parent('.minibox').addClass('selected');});
				$(".minibox").draggable({ containment: "#sandbox_box", scroll: false });
				$(".minibox").resizable({containment: "#sandbox_box"});
              }
            }
          },
          error: function (data, status, e)
          {
            alert(e);
          }
        }
      )
    
      return false;

    }
</script>
</html>
